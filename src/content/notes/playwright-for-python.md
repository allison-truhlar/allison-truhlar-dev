---
title: "Playwright for Python"
description: "Using Playwright for Python to write browser tests"
pubDate: "Sept 5 2024"
heroImage: "/post_img.webp"
tags: ["learning in public", "python"]
---

### Install

Install the Playwright Pytest plugin and Playwright with the Chromium browser dependency inside the environment where you will use them. In my case, I made a new conda environment:

```Shell
conda create --name tests
conda activate tests
conda config --add channels microsoft
conda install pytest-playwright
playwright install --with-deps chromium
```

### Create tests

All files with tests must follow the `test_` prefix convention, such as `test_example.py`. I organized my tests into multiple `test_` files inside a top-level directory called `tests`, organized by the section of the website to which the tests related.

Tests are written in Python functions, which also follow the `test_` prefix convention. This is the basic format for writing a test, from the [Playwright for Python docs](https://playwright.dev/python/docs/writing-tests):

```Python
import re
from playwright.sync_api import Page, expect

def test_has_title(page: Page):
    # Act
    page.goto("https://playwright.dev/")

    # Assert state against expected outcome
    expect(page).to_have_title(re.compile("Playwright"))
```

My basic workflow for creating browser tests was to use the Playwright `codegen` command with the URL to the site I was testing:

```Shell
playwright codegen https://your-target-website.com
```

I then performed actions in the browser provided by Playwright and Plawyright generated suggested code for these interactions. After performing the desired actions, I created assertions by clicking on one of the icons in the toolbar at the top of the Playwright browser and then clicking on an element on the page to assert against. The three icons are: `assert visibility`, `assert text`, and `assert value`, respectively. Finally, I copied the code generated by Playwright into my editor.

The most common

#### Arrange-Act-Assert

Playwright Pytest plugin tests follow the "Arrange-Act-Assert" pattern for testing - I already noted two of these steps in the sample test code above. The Playwright Test plugin uses test fixtures to "arrange" tests. From [pytest](https://docs.pytest.org/en/latest/explanation/fixtures.html), a fixture "provides a defined, reliable and consistent context." For example, the built-in `Page` fixture is passed to the sample test above, providing a brand new browser profile so every test is isolated from other tests in a fresh environment.

I wanted all my tests to run the same set of actions at the start of the test to go to the same site and ensure it had loaded correctly before attempting to iteract. For this purpose, I made a custom fixture in a file called `conftest.py`. You must use the `@pytest.fixture` decorator to mark a function as a fixture. The `autouse=True` flag means this fixture will be automatically passed to all my test functions and run prior to each test's execution - no need to make modifications to the tests.

```Python
@pytest.fixture(scope="function", autouse=True)
def before_each(page: Page):
    page.goto(URL)
    page.wait_for_function(f"document.title.includes('{SITE_TITLE}')")
```

I also made a fixture that I only wanted to run before certain tests. For this fixture, I simply omitted the `autouse=True` flag in the fixture defintiion, and passed the fixture name to the tests I needed it in. These tests still used the `before_each` fixture as well. E.g.:

```Python
def test_example(fixture_name, page: Page):
    # Act
    page.goto("https://playwright.dev/")

    # Assert state against expected outcome
    expect(page).to_have_title(re.compile("Playwright"))
```

### Run tests

To run tests, navigate to the directory where the test file(s) are contained and use the command:

```Shell
pytest
```

Or, include the path to the directory containing the tests - in my case, the top-level directory `tests`:

```Shell
pytest tests
```

To run a specific file, use:

```Shell
pytest tests/test_{rest_of_filename}.py.
```

To run a single test, use:

```Shell
pytest tests -k test_{function_name}
```

### Debug tests

If a test fails and you wish to do further debugging by watching a recording of what happened, use the command:

```Shell
pytest tests --tracing on -k test_{failed_function_name}
```

The recording will save inside a new folder `test-results` in the directory the command was called from. To view the recording, use the command:

```Shell
playwright show-trace test-results/{test-subfolder-name}/trace.zip
```
